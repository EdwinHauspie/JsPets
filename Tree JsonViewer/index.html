<!DOCTYPE html>
<html>

<head>
    <title>JsonViewer</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="favicon.ico" />

    <script>
        let render = data => {
            let html = '';
            const sort = $('#sort').val(), depth = $('#depth').val() || 999;
            const toggle = arr => arr.length ? '<i class="fa toggle"></i>' : '';

            (function ___(o, name, curDepth) {
                if (curDepth >= depth) return;

                name = name === null ? '' : name;

                if (o === null) {
                    html += `<li>${name} <span><em>null</em></span></li>`;
                }
                else if (o instanceof Array) {
                    html += `<li>${toggle(o)} ${name} <em>[${o.length}]</em>`;
                    if (o.length) {
                        html += '<ul>';
                        for (var i = 0; i < o.length; i++) {
                            ___(o[i], i, curDepth + 1);
                        }
                        html += '</ul>';
                    }
                    html += '</li>';
                }
                else if (typeof o == 'object') {
                    let props = Object.keys(o);
                    html += `<li>${toggle(props)} ${name} <em>{${props.length}}</em>`;
                    if (props.length) {
                        html += '<ul>';
                        if (sort) props = props.sort((a, b) => a.localeCompare(b));
                        for (var i = 0; i < props.length; i++) {
                            ___(o[props[i]], props[i], curDepth + 1);
                        }
                        html += '</ul>';
                    }
                    html += '</li>';
                }
                else {
                    html += `<li>${name} <span>` + (typeof o === 'string' ? `"${o.replace(/\</g, '&lt;')}"` : o) + '</span></li>';
                }
            })(data, null, 0);

            $('.tree').hide().html(`<ul>${html}</ul>`).fadeIn();
            $('.tree > ul > li').addClass('open');
        }

        $(() => {
            $('.tree').on('click', '.toggle', e => {
                e.stopPropagation();
                $(e.target).closest('li').toggleClass('open');
                return false;
            });

            $('#parse').click(e => {
                try {
                    $('.tree').empty();
                    render(JSON.parse($('#json').val()));
                } catch (e) {
                    alert('Invalid JSON.');
                }
            });

            $('#get').click(e => {
                $('.tree').empty();
                let url = $('#url').val();
                localStorage.setItem('url', url);
                $.getJSON('/?jsonUrl=' + encodeURIComponent(url)).then(r => render(r)).fail(r => $('.tree').html('Error'));
            });

            $('#depth').on('change', e => $(e.target).parent().find('span').text(e.target.valueAsNumber));

            const storedUrl = localStorage.getItem('url');
            if (storedUrl) $('#url').val(storedUrl);
            $('#url').on('keydown', e => { if (e.which === 13) $('#get').click(); });
        });
    </script>
</head>

<body>
    <div class="actions">
        <a href="javascript:$('.tree').find('li').addClass('open');"><i class="fas fa-plus"></i><i class="fas fa-plus"></i><i class="fas fa-plus"></i>Expand</a>
        <a href="javascript:$('.tree').find('li').removeClass('open').first().addClass('open');"><i class="fas fa-minus"></i><i class="fas fa-minus"></i><i class="fas fa-minus"></i>Collapse</a>
        <select id="depth">
            <option value="">No depth limit</option>
            <option value="2">Render depth 2</option>
            <option value="3">Render depth 3</option>
        </select>
        <select id="sort">
            <option value="">No sorting</option>
            <option value="1">Sort properties</option>
        </select>
        <textarea id="url" spellcheck="false" autocomplete="off">https://jsonplaceholder.typicode.com/users</textarea><a href="javascript:void();" id="get">Get</a>
        <textarea id="json" spellcheck="false" autocomplete="off" style="margin: 0px; width: 420px; height: 6px;">{ "firstName": "John", "lastName": "Smith", "age": 25 }</textarea><a href="javascript:void();" id="parse">Parse</a>
    </div>

    <div class="tree"><em>No data</em></div>
</body>

</html>